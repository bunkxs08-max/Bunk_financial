<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Buku Financial Freelancer Art ‚Äî Template 1 (Operasional)</title>
  <style>
    :root{
      --bg:#0b1020; --card:#121a33; --text:#e9ecff; --muted:#a9b1d6;
      --line: rgba(255,255,255,.08);
      --green:#22c55e; --yellow:#f59e0b; --red:#ef4444; --blue:#3b82f6; --gray:#94a3b8;
      --shadow: 0 14px 40px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: radial-gradient(900px 450px at 20% 0%, rgba(59,130,246,.18), transparent 60%),
                  radial-gradient(900px 450px at 80% 10%, rgba(34,197,94,.14), transparent 60%),
                  var(--bg);
      color:var(--text);
    }
    header{
      padding:22px 14px 10px;
      max-width:1200px; margin:0 auto;
      display:flex; gap:12px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap;
    }
    .title h1{margin:0; font-size:18px}
    .title p{margin:8px 0 0; color:var(--muted); font-size:13px; line-height:1.35}
    .toolbar{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .btn{
      border:1px solid var(--line); background:rgba(255,255,255,.04); color:var(--text);
      padding:10px 12px; border-radius:12px; cursor:pointer;
      display:inline-flex; gap:8px; align-items:center; font-weight:700; font-size:13px;
    }
    .btn:hover{background:rgba(255,255,255,.06)}
    .btn.primary{border-color:rgba(59,130,246,.35); background:rgba(59,130,246,.16)}
    .btn.danger{border-color:rgba(239,68,68,.35); background:rgba(239,68,68,.12)}
    .wrap{max-width:1200px; margin:0 auto; padding:0 14px 40px}
    .grid{display:grid; grid-template-columns: 1fr; gap:14px;}
    @media(min-width:980px){ .grid{grid-template-columns: 1fr 1fr;} .span2{grid-column:1 / -1;} }
    section.card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      overflow:hidden;
    }
    .card-head{
      padding:14px 14px 10px;
      display:flex; align-items:flex-end; justify-content:space-between; gap:10px; flex-wrap:wrap;
      background:rgba(0,0,0,.08);
      border-bottom:1px solid var(--line);
    }
    .card-head h2{margin:0; font-size:14px}
    .card-head .hint{color:var(--muted); font-size:12px}
    .card-body{padding:12px 14px 14px}
    .table-wrap{overflow:auto; border-radius:14px; border:1px solid var(--line); background:rgba(0,0,0,.12)}
    table{width:100%; border-collapse:collapse; min-width: 760px;}
    th, td{padding:10px 10px; border-bottom:1px solid var(--line); font-size:12.5px; vertical-align:top}
    th{color:#dbe2ff; text-align:left; background:rgba(255,255,255,.04); position:sticky; top:0; z-index:1}
    tr:hover td{background:rgba(255,255,255,.03)}
    .mono{font-variant-numeric: tabular-nums; font-feature-settings: "tnum" 1;}
    .muted{color:var(--muted)}
    .right{text-align:right}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px; border-radius:999px; font-weight:800; font-size:12px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      white-space:nowrap;
    }
    .dot{width:10px; height:10px; border-radius:999px; background:var(--gray); box-shadow:0 0 0 4px rgba(148,163,184,.12)}
    .pill.green .dot{background:var(--green); box-shadow:0 0 0 4px rgba(34,197,94,.14)}
    .pill.yellow .dot{background:var(--yellow); box-shadow:0 0 0 4px rgba(245,158,11,.14)}
    .pill.red .dot{background:var(--red); box-shadow:0 0 0 4px rgba(239,68,68,.14)}
    .pill.blue .dot{background:var(--blue); box-shadow:0 0 0 4px rgba(59,130,246,.14)}

    .kpi{display:grid; gap:10px; grid-template-columns: repeat(2, minmax(0,1fr));}
    @media(min-width:560px){ .kpi{grid-template-columns: repeat(4, minmax(0,1fr));} }
    .kpi .box{border:1px solid var(--line); background:rgba(0,0,0,.12); border-radius:16px; padding:12px;}
    .kpi .label{color:var(--muted); font-size:12px}
    .kpi .val{margin-top:6px; font-size:16px; font-weight:900}
    .kpi .sub{margin-top:4px; color:var(--muted); font-size:11.5px}

    .search{
      border:1px solid var(--line); background:rgba(0,0,0,.18); color:var(--text);
      padding:10px 12px; border-radius:12px; min-width:240px;
      outline:none;
    }
    .row-actions{display:flex; gap:8px; flex-wrap:wrap}
    .mini{
      padding:7px 10px; border-radius:10px; font-size:12px; font-weight:800;
      border:1px solid var(--line); background:rgba(255,255,255,.04); color:var(--text);
      cursor:pointer;
    }
    .mini:hover{background:rgba(255,255,255,.06)}
    .mini.danger{border-color:rgba(239,68,68,.35); background:rgba(239,68,68,.12)}
    .mini.primary{border-color:rgba(59,130,246,.35); background:rgba(59,130,246,.16)}

    /* Modal */
    .modal-backdrop{
      position:fixed; inset:0; background:rgba(0,0,0,.55);
      display:none; align-items:center; justify-content:center; padding:14px;
      z-index:999;
    }
    .modal{
      width:min(720px, 100%); border-radius:18px;
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(18,26,51,.98), rgba(12,18,38,.98));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .modal-head{
      padding:14px; display:flex; align-items:center; justify-content:space-between; gap:10px;
      border-bottom:1px solid var(--line);
    }
    .modal-head h3{margin:0; font-size:14px}
    .modal-body{padding:14px}
    .form-grid{display:grid; gap:10px; grid-template-columns:1fr;}
    @media(min-width:700px){ .form-grid{grid-template-columns:1fr 1fr;} }
    label{display:block; font-size:12px; color:var(--muted); margin-bottom:6px}
    input, select, textarea{
      width:100%; padding:10px 10px; border-radius:12px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.18); color:var(--text);
      outline:none;
    }
    textarea{min-height:90px; resize:vertical}
    .modal-foot{
      padding:14px; border-top:1px solid var(--line);
      display:flex; justify-content:flex-end; gap:10px; flex-wrap:wrap;
    }
    .small{font-size:11.5px}
  </style>
</head>
<body>
<header>
  <div class="title">
    <h1>üìò Buku Financial Freelancer Art ‚Äî Template 1 (Operasional)</h1>
    <p>
      Sekarang bisa <b>Tambah / Edit / Hapus</b> data langsung (HP friendly). Data tersimpan di <b>browser</b> (localStorage).
      <br/>Masih ada <b>Export/Import JSON</b> buat backup & pindah device.
    </p>
  </div>

  <div class="toolbar">
    <input id="search" class="search" placeholder="Cari: nama klien / jenis order / catatan..." />
    <button class="btn primary" id="btnAddOrder">‚ûï Tambah Order</button>
    <button class="btn primary" id="btnAddIncome">‚ûï Tambah Income</button>
    <button class="btn primary" id="btnAddExpense">‚ûï Tambah Expense</button>
    <button class="btn" id="btnAddSample">‚ú® Isi contoh data</button>
    <button class="btn" id="btnExport">‚¨áÔ∏è Export JSON</button>
    <button class="btn" id="btnImport">‚¨ÜÔ∏è Import JSON</button>
    <button class="btn danger" id="btnReset">üóëÔ∏è Reset data</button>
  </div>
</header>

<div class="wrap">
  <div class="kpi" id="kpi"></div>

  <div class="grid" style="margin-top:14px;">
    <section class="card span2">
      <div class="card-head">
        <div>
          <h2>üìÑ ORDER LIST (MASTER ORDER)</h2>
          <div class="hint">Status pakai simbol warna + tulisan. Klik Edit/Hapus di kolom Action.</div>
        </div>
      </div>
      <div class="card-body">
        <div class="table-wrap">
          <table id="tblOrders">
            <thead>
              <tr>
                <th>No</th>
                <th>Tanggal Order</th>
                <th>Nama Klien</th>
                <th>Jenis Order</th>
                <th class="right">Harga</th>
                <th class="right">DP</th>
                <th class="right">Sisa</th>
                <th>Status Order</th>
                <th>Status Bayar</th>
                <th>Deadline</th>
                <th>Catatan</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="card-head">
        <div>
          <h2>üìÑ INCOME LOG (PEMASUKAN)</h2>
          <div class="hint">Net Income = Jumlah Masuk ‚àí Fee</div>
        </div>
      </div>
      <div class="card-body">
        <div class="table-wrap">
          <table id="tblIncome" style="min-width:920px">
            <thead>
              <tr>
                <th>Tanggal</th>
                <th>Nama Klien</th>
                <th>Jenis Order</th>
                <th class="right">Jumlah Masuk</th>
                <th>Metode</th>
                <th>Mata Uang</th>
                <th class="right">Fee</th>
                <th class="right">Net</th>
                <th>Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="card-head">
        <div>
          <h2>üìÑ EXPENSE LOG (PENGELUARAN)</h2>
          <div class="hint">Catat biaya software, asset, internet, dll</div>
        </div>
      </div>
      <div class="card-body">
        <div class="table-wrap">
          <table id="tblExpense" style="min-width:860px">
            <thead>
              <tr>
                <th>Tanggal</th>
                <th>Jenis Pengeluaran</th>
                <th>Keterangan</th>
                <th class="right">Jumlah</th>
                <th>Metode</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <section class="card span2">
      <div class="card-head">
        <div>
          <h2>üìÑ SUMMARY BULANAN</h2>
          <div class="hint">Profit Bersih = Total Income ‚àí Total Expense</div>
        </div>
      </div>
      <div class="card-body">
        <div class="table-wrap">
          <table id="tblSummary" style="min-width:760px">
            <thead>
              <tr>
                <th>Bulan</th>
                <th class="right">Total Income (Net)</th>
                <th class="right">Total Expense</th>
                <th class="right">Profit Bersih</th>
                <th class="right">Jumlah Order</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="hint small" style="margin-top:10px; color:var(--muted)">
          Summary dihitung otomatis dari tabel Income/Expense dan Order List.
        </div>
      </div>
    </section>

    <section class="card span2">
      <div class="card-head">
        <div>
          <h2>üìÑ CLIENT TRACKING (OPTIONAL)</h2>
          <div class="hint">Total bayar dihitung dari Income (Net). Repeat = total order ‚â• 2.</div>
        </div>
      </div>
      <div class="card-body">
        <div class="table-wrap">
          <table id="tblClients" style="min-width:760px">
            <thead>
              <tr>
                <th>Nama Klien</th>
                <th class="right">Total Order</th>
                <th class="right">Total Bayar (Net)</th>
                <th>Repeat</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>
  </div>
</div>

<input type="file" id="fileInput" accept="application/json" style="display:none" />

<!-- Modal -->
<div class="modal-backdrop" id="backdrop">
  <div class="modal">
    <div class="modal-head">
      <h3 id="modalTitle">Tambah Data</h3>
      <button class="mini" id="btnClose">‚úñ</button>
    </div>
    <div class="modal-body" id="modalBody"></div>
    <div class="modal-foot">
      <button class="btn" id="btnCancel">Batal</button>
      <button class="btn primary" id="btnSave">Simpan</button>
    </div>
  </div>
</div>

<script>
  // ---------- Helpers ----------
  const fmtIDR = (n) => new Intl.NumberFormat('id-ID').format(Math.round(n || 0));
  const parseNum = (v) => {
    if (v === null || v === undefined) return 0;
    const s = String(v).replace(/[^\d.-]/g,'');
    const n = Number(s);
    return Number.isFinite(n) ? n : 0;
  };
  const ym = (dateStr) => { // "DD/MM/YYYY" -> "YYYY-MM"
    if(!dateStr) return "";
    const [d,m,y] = dateStr.split("/").map(s=>s.trim());
    if(!y || !m) return "";
    return `${y}-${String(m).padStart(2,"0")}`;
  };
  const ymLabel = (ymStr) => {
    if(!ymStr) return "";
    const [y,m] = ymStr.split("-");
    const names = ["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agu","Sep","Okt","Nov","Des"];
    return `${names[parseInt(m,10)-1]} ${y}`;
  };
  function pill(text){
    const t = (text || "").toLowerCase();
    let cls = "pill";
    if(["lunas","paid","masuk","done"].includes(t)) cls += " green";
    else if(["dp","partial","pending"].includes(t)) cls += " yellow";
    else if(["belum bayar","unpaid","overdue","cancel"].includes(t)) cls += " red";
    else if(["on progress","wip","ongoing"].includes(t)) cls += " blue";
    return `<span class="${cls}"><span class="dot"></span><span>${text || "-"}</span></span>`;
  }

  // ---------- Storage ----------
  const KEY = "art_finance_template_operasional_v1";
  const defaultData = { orders: [], income: [], expense: [] };

  function load(){
    try{
      const raw = localStorage.getItem(KEY);
      if(!raw) return structuredClone(defaultData);
      const p = JSON.parse(raw);
      return {
        orders: Array.isArray(p.orders) ? p.orders : [],
        income: Array.isArray(p.income) ? p.income : [],
        expense: Array.isArray(p.expense) ? p.expense : [],
      };
    } catch { return structuredClone(defaultData); }
  }
  function save(data){ localStorage.setItem(KEY, JSON.stringify(data)); }

  // ---------- Modal ----------
  const backdrop = document.getElementById("backdrop");
  const modalTitle = document.getElementById("modalTitle");
  const modalBody = document.getElementById("modalBody");
  let modalState = { kind:null, mode:"add", index:-1 };

  function openModal(kind, mode, index, current){
    modalState = { kind, mode, index };
    modalTitle.textContent = (mode==="add" ? "Tambah " : "Edit ") + kind.toUpperCase();
    modalBody.innerHTML = buildForm(kind, current || {});
    backdrop.style.display = "flex";
  }
  function closeModal(){
    backdrop.style.display = "none";
    modalBody.innerHTML = "";
    modalState = { kind:null, mode:"add", index:-1 };
  }
  function buildForm(kind, v){
    if(kind==="order"){
      return `
        <div class="form-grid">
          <div><label>Tanggal Order (DD/MM/YYYY)</label><input id="f_date" value="${v.date||""}" placeholder="05/01/2026"></div>
          <div><label>Deadline (DD/MM/YYYY)</label><input id="f_deadline" value="${v.deadline||""}" placeholder="12/01/2026"></div>
          <div><label>Nama Klien</label><input id="f_client" value="${v.client||""}" placeholder="Alex"></div>
          <div><label>Jenis Order</label><input id="f_type" value="${v.type||""}" placeholder="Full Body Anime"></div>
          <div><label>Harga</label><input id="f_price" inputmode="numeric" value="${v.price??""}" placeholder="500000"></div>
          <div><label>DP</label><input id="f_dp" inputmode="numeric" value="${v.dp??""}" placeholder="250000"></div>
          <div>
            <label>Status Order</label>
            <select id="f_orderStatus">
              ${opt(v.orderStatus, ["On Progress","WIP","Done","Cancel"])}
            </select>
          </div>
          <div>
            <label>Status Bayar</label>
            <select id="f_payStatus">
              ${opt(v.payStatus, ["DP","Lunas","Belum Bayar","Cancel"])}
            </select>
          </div>
          <div style="grid-column:1/-1">
            <label>Catatan</label><textarea id="f_note" placeholder="Revisi max 2x">${v.note||""}</textarea>
          </div>
        </div>
      `;
    }
    if(kind==="income"){
      return `
        <div class="form-grid">
          <div><label>Tanggal (DD/MM/YYYY)</label><input id="f_date" value="${v.date||""}" placeholder="06/01/2026"></div>
          <div><label>Status</label>
            <select id="f_status">${opt(v.status, ["Masuk","Pending","Cancel"])}</select>
          </div>
          <div><label>Nama Klien</label><input id="f_client" value="${v.client||""}" placeholder="Alex"></div>
          <div><label>Jenis Order</label><input id="f_type" value="${v.type||""}" placeholder="DP Full Body"></div>
          <div><label>Jumlah Masuk</label><input id="f_amount" inputmode="numeric" value="${v.amount??""}" placeholder="250000"></div>
          <div><label>Fee</label><input id="f_fee" inputmode="numeric" value="${v.fee??0}" placeholder="15000"></div>
          <div><label>Metode</label><input id="f_method" value="${v.method||""}" placeholder="PayPal / Transfer"></div>
          <div><label>Mata Uang</label><input id="f_currency" value="${v.currency||"IDR"}" placeholder="IDR"></div>
        </div>
      `;
    }
    // expense
    return `
      <div class="form-grid">
        <div><label>Tanggal (DD/MM/YYYY)</label><input id="f_date" value="${v.date||""}" placeholder="07/01/2026"></div>
        <div><label>Metode</label><input id="f_method" value="${v.method||""}" placeholder="Debit / E-Wallet"></div>
        <div><label>Jenis Pengeluaran</label><input id="f_category" value="${v.category||""}" placeholder="Software"></div>
        <div><label>Jumlah</label><input id="f_amount" inputmode="numeric" value="${v.amount??""}" placeholder="120000"></div>
        <div style="grid-column:1/-1">
          <label>Keterangan</label><textarea id="f_desc" placeholder="Clip Studio (bulanan)">${v.desc||""}</textarea>
        </div>
      </div>
    `;
  }
  function opt(current, options){
    const c = (current||"").trim();
    return options.map(o=>{
      const sel = (o===c) ? "selected" : "";
      return `<option ${sel}>${o}</option>`;
    }).join("");
  }
  function readForm(){
    const k = modalState.kind;
    if(k==="order"){
      return {
        date: val("f_date"),
        deadline: val("f_deadline"),
        client: val("f_client"),
        type: val("f_type"),
        price: parseNum(val("f_price")),
        dp: parseNum(val("f_dp")),
        orderStatus: val("f_orderStatus"),
        payStatus: val("f_payStatus"),
        note: val("f_note")
      };
    }
    if(k==="income"){
      return {
        date: val("f_date"),
        status: val("f_status"),
        client: val("f_client"),
        type: val("f_type"),
        amount: parseNum(val("f_amount")),
        fee: parseNum(val("f_fee")),
        method: val("f_method"),
        currency: val("f_currency") || "IDR"
      };
    }
    return {
      date: val("f_date"),
      method: val("f_method"),
      category: val("f_category"),
      amount: parseNum(val("f_amount")),
      desc: val("f_desc")
    };
  }
  function val(id){ return (document.getElementById(id)?.value || "").trim(); }

  // ---------- Render ----------
  function render(){
    const data = load();
    const q = (document.getElementById("search").value || "").toLowerCase().trim();

    const orders = data.orders.filter(o=>{
      if(!q) return true;
      return `${o.client} ${o.type} ${o.note}`.toLowerCase().includes(q);
    });

    // Orders
    const tbO = document.querySelector("#tblOrders tbody");
    tbO.innerHTML = orders.map((o, idx)=>{
      const price = o.price||0, dp=o.dp||0;
      const sisa = Math.max(0, price - dp);
      const realIndex = data.orders.indexOf(o);
      return `
        <tr>
          <td class="mono">${idx+1}</td>
          <td class="mono">${o.date||"-"}</td>
          
